<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>FlowState | Minimalist Pomodoro Timer & Time Tracker</title>
    <meta name="description" content="A free, privacy-focused online Pomodoro timer and time tracking dashboard. Features dark mode, data export, and visual analytics. Built for developers and makers.">
    <meta name="keywords" content="pomodoro timer, online timer, time tracking, productivity tool, flow state, free timer, focus timer">
    <meta name="author" content="FlowState Team">
    
    <!-- Open Graph / Social Sharing -->
    <meta property="og:title" content="FlowState - Find Your Focus">
    <meta property="og:description" content="Minimalist, efficient, and private time tracking dashboard.">
    <meta property="og:type" content="website">
    
    <!-- External Resources -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --border-color: rgba(255, 255, 255, 0.1);
            --nav-height: 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* --- Navbar --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--nav-height);
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color); z-index: 1000;
            display: flex; justify-content: center;
        }
        .nav-content {
            width: 100%; max-width: 1200px; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-weight: 800; font-size: 1.2rem; color: white; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .nav-links a { color: var(--text-secondary); text-decoration: none; margin-left: 20px; font-size: 0.9rem; transition: color 0.3s; }
        .nav-links a:hover { color: white; }

        /* --- Main Layout --- */
        .main-wrapper {
            margin-top: var(--nav-height);
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- Hero Section (The App) --- */
        .hero-section {
            width: 100%;
            padding: 40px 20px;
            background: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.15), transparent 50%);
            display: flex; justify-content: center;
        }
        
        /* App Styles */
        .app-container {
            width: 100%; max-width: 1200px;
            display: grid; grid-template-columns: 350px 1fr; gap: 20px;
        }
        .card {
            background: var(--card-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--border-color); border-radius: 16px;
            padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex; flex-direction: column;
        }
        h2 { font-size: 1.1rem; margin-bottom: 15px; color: var(--text-secondary); font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .timer-display { font-family: 'JetBrains Mono', monospace; font-size: 4rem; font-weight: 700; text-align: center; margin: 10px 0; text-shadow: 0 0 20px rgba(59, 130, 246, 0.3); font-variant-numeric: tabular-nums; }
        .mode-switch { display: flex; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 4px; margin-bottom: 15px; }
        .mode-btn { flex: 1; background: transparent; border: none; color: var(--text-secondary); padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; }
        .mode-btn.active { background: var(--accent-blue); color: white; }
        .project-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .project-select { flex: 1; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: white; border-radius: 8px; outline: none; }
        .icon-btn { width: 42px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 8px; cursor: pointer; font-size: 1.2rem; }
        .icon-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .btn-group { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: #fff; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-start { background: var(--accent-green); }
        .btn-stop { background: var(--accent-red); }
        .btn-reset { background: var(--text-secondary); }
        .log-list { flex: 1; overflow-y: auto; margin-top: 10px; padding-right: 5px; max-height: 300px; }
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; color: var(--text-secondary); }
        .delete-btn { color: var(--accent-red); cursor: pointer; border: none; background: none; padding: 0 5px; }
        .dashboard-grid { display: grid; grid-template-rows: auto 1fr; gap: 20px; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-container { position: relative; height: 250px; width: 100%; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.open { display: flex; }
        .modal-content { background: #1e293b; border: 1px solid var(--border-color); width: 400px; max-width: 90%; border-radius: 16px; padding: 24px; }
        .add-form { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-text { flex: 1; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: white; border-radius: 6px; }
        .input-color { width: 40px; height: 38px; border: none; background: none; cursor: pointer; }
        .project-list-item { display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.05); margin-bottom: 5px; border-radius: 4px; align-items: center; }

        /* --- Content Section --- */
        .content-section {
            width: 100%; max-width: 1000px; padding: 60px 20px;
            text-align: center;
        }
        .section-title { font-size: 2rem; font-weight: 800; margin-bottom: 40px; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .features-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px;
            text-align: left;
        }
        .feature-item {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border-color);
            padding: 30px; border-radius: 12px; transition: transform 0.3s;
        }
        .feature-item:hover { transform: translateY(-5px); border-color: var(--accent-blue); }
        .feature-icon { font-size: 2rem; margin-bottom: 15px; }
        .feature-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; color: white; }
        .feature-desc { font-size: 0.95rem; color: var(--text-secondary); }

        .guide-step {
            display: flex; align-items: flex-start; gap: 20px; text-align: left; margin-bottom: 30px;
            background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px;
        }
        .step-num { font-size: 1.5rem; font-weight: 800; color: var(--accent-blue); opacity: 0.8; }

        footer {
            width: 100%; padding: 40px 20px; border-top: 1px solid var(--border-color);
            text-align: center; color: var(--text-secondary); font-size: 0.9rem;
            background: #0b1120;
        }

        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: 1fr; }
            .timer-display { font-size: 3rem; }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
    <div class="nav-content">
        <a href="#" class="logo">‚ö° FlowState</a>
        <div class="nav-links">
            <a href="#features">Features</a>
            <a href="#guide">Guide</a>
            <a href="https://github.com" target="_blank">GitHub</a>
        </div>
    </div>
</nav>

<div class="main-wrapper">
    
    <!-- Hero Section: The Tool -->
    <section class="hero-section">
        <div class="app-container">
            <!-- Left Control Panel -->
            <div class="card control-panel">
                <div class="mode-switch">
                    <button class="mode-btn active" onclick="app.setMode('pomodoro')">üçÖ Pomodoro</button>
                    <button class="mode-btn" onclick="app.setMode('stopwatch')">‚è±Ô∏è Stopwatch</button>
                </div>
                <div class="project-row">
                    <select id="projectSelect" class="project-select"></select>
                    <button class="icon-btn" onclick="app.ui.toggleModal(true)" title="Manage Projects">‚öôÔ∏è</button>
                </div>
                <div class="timer-display" id="timerDisplay">25:00</div>
                <div class="btn-group">
                    <button class="btn btn-start" id="startBtn" onclick="app.start()">Start</button>
                    <button class="btn btn-stop" id="stopBtn" onclick="app.stop()" disabled>Finish</button>
                    <button class="btn btn-reset" onclick="app.reset()">Reset</button>
                </div>
                <div style="flex: 1; margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 15px;">
                    <h2>
                        Recent Logs
                        <div style="font-size: 0.8rem;">
                            <button onclick="app.data.exportData()" style="background:none; border:none; color:var(--accent-blue); cursor:pointer;" title="Download JSON">‚¨áÔ∏è Backup</button>
                            <label style="cursor:pointer; color:var(--accent-green); margin-left: 10px;" title="Upload JSON">
                                ‚¨ÜÔ∏è Restore
                                <input type="file" onchange="app.data.importData(this)" style="display:none;" accept=".json">
                            </label>
                        </div>
                    </h2>
                    <div id="recentLogs" class="log-list"></div>
                </div>
            </div>

            <!-- Right Dashboard -->
            <div class="dashboard-grid">
                <div class="stats-row">
                    <div class="card">
                        <h2>üìä Project Distribution</h2>
                        <div class="chart-container"><canvas id="pieChart"></canvas></div>
                    </div>
                    <div class="card">
                        <h2>üìà 7-Day Trend (Minutes)</h2>
                        <div class="chart-container"><canvas id="barChart"></canvas></div>
                    </div>
                </div>
                <div class="card">
                    <h2>üìÖ Today's Overview</h2>
                    <div style="display: flex; gap: 40px;">
                        <div><div style="font-size: 0.9rem; color: var(--text-secondary);">Total Focus</div><div style="font-size: 2rem; font-weight: bold;" id="todayTotal">0h 0m 0s</div></div>
                        <div><div style="font-size: 0.9rem; color: var(--text-secondary);">Sessions</div><div style="font-size: 2rem; font-weight: bold;" id="todayCount">0</div></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SEO Content: Features -->
    <article id="features" class="content-section">
        <h2 class="section-title">Why FlowState?</h2>
        <div class="features-grid">
            <div class="feature-item">
                <div class="feature-icon">üîí</div>
                <h3 class="feature-title">Privacy First</h3>
                <p class="feature-desc">All data is stored locally in your browser. No servers, no accounts, no tracking. Your data belongs to you.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üìä</div>
                <h3 class="feature-title">Visual Analytics</h3>
                <p class="feature-desc">Built-in charting engine automatically generates project distribution and weekly trend reports.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üíæ</div>
                <h3 class="feature-title">Data Portability</h3>
                <p class="feature-desc">Export your logs to JSON format anytime for backup or analysis. Restore them on any device.</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">‚ö°</div>
                <h3 class="feature-title">Distraction Free</h3>
                <p class="feature-desc">No ads, no popups. A dark-mode interface designed specifically to help you maintain flow.</p>
            </div>
        </div>
    </article>

    <!-- SEO Content: Guide -->
    <article id="guide" class="content-section" style="background: rgba(0,0,0,0.1); width:100%; max-width:100%;">
        <div style="max-width: 800px; margin: 0 auto;">
            <h2 class="section-title">How to Use</h2>
            <div class="guide-step">
                <div class="step-num">01</div>
                <div>
                    <h3 class="feature-title">Set Your Projects</h3>
                    <p class="feature-desc">Click the ‚öôÔ∏è icon next to the dropdown to add your tasks (e.g., Coding, Reading, Design). Color-code them for better visualization.</p>
                </div>
            </div>
            <div class="guide-step">
                <div class="step-num">02</div>
                <div>
                    <h3 class="feature-title">Choose Your Mode</h3>
                    <p class="feature-desc">Need intense focus? Use the **Pomodoro** timer (25m). Tracking meetings or loose tasks? Use the **Stopwatch**.</p>
                </div>
            </div>
            <div class="guide-step">
                <div class="step-num">03</div>
                <div>
                    <h3 class="feature-title">Review & Improve</h3>
                    <p class="feature-desc">Check the dashboard at the end of the day. See where your time went and optimize your schedule.</p>
                </div>
            </div>
        </div>
    </article>

</div>

<footer>
    <p>¬© 2023-2024 FlowState. Built for Makers.</p>
    <p style="font-size: 0.8rem; margin-top: 10px; opacity: 0.5;">Privacy Focused. No Cookies. Open Source.</p>
</footer>

<!-- Modal -->
<div class="modal-overlay" id="projectModal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3>Manage Projects</h3>
            <button onclick="app.ui.toggleModal(false)" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">√ó</button>
        </div>
        <div class="add-form">
            <input type="text" id="newProjectName" class="input-text" placeholder="Project name...">
            <input type="color" id="newProjectColor" class="input-color" value="#3b82f6">
            <button class="btn btn-start" style="flex: 0 0 60px;" onclick="app.data.addProject()">Add</button>
        </div>
        <div id="projectList" style="max-height: 300px; overflow-y: auto;"></div>
    </div>
</div>

<!-- Core Logic -->
<script>
class TimeMaster {
    constructor() {
        this.state = { mode: 'pomodoro', isRunning: false, startTime: null, duration: 25 * 60, timerId: null, selectedProjectId: null };
        try {
            const raw = localStorage.getItem('flowStateDB');
            this.db = raw ? JSON.parse(raw) : this.getDefaultDB();
            if (!this.db.projects || !Array.isArray(this.db.projects)) this.db = this.getDefaultDB();
        } catch (e) { this.db = this.getDefaultDB(); }
        this.state.selectedProjectId = this.db.projects[0]?.id;
        this.charts = { pie: null, bar: null };
        this.init();
    }
    
    getDefaultDB() {
        return {
            logs: [],
            projects: [
                { id: 'p1', name: 'üíª Coding', color: '#3b82f6' },
                { id: 'p2', name: 'üìö Learning', color: '#10b981' },
                { id: 'p3', name: '‚òï Break', color: '#f59e0b' }
            ]
        };
    }
    
    init() {
        this.cacheDOM();
        this.bindEvents();
        this.renderProjectSelect();
        this.updateUI();
        setTimeout(() => this.initCharts(), 100);
        
        // Feature: Prevent accidental close
        window.onbeforeunload = (e) => {
            if (this.state.isRunning) {
                e.preventDefault();
                e.returnValue = '';
            }
        };
    }
    
    cacheDOM() {
        this.dom = {
            display: document.getElementById('timerDisplay'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            projectSelect: document.getElementById('projectSelect'),
            recentLogs: document.getElementById('recentLogs'),
            todayTotal: document.getElementById('todayTotal'),
            todayCount: document.getElementById('todayCount'),
            modal: document.getElementById('projectModal'),
            projectList: document.getElementById('projectList'),
            newProjectName: document.getElementById('newProjectName'),
            newProjectColor: document.getElementById('newProjectColor')
        };
    }
    
    bindEvents() {
        this.dom.projectSelect.addEventListener('change', (e) => this.state.selectedProjectId = e.target.value);
        this.dom.modal.addEventListener('click', (e) => { if (e.target === this.dom.modal) this.ui.toggleModal(false); });
    }
    
    ui = {
        toggleModal: (show) => {
            if (show) { this.dom.modal.classList.add('open'); this.renderProjectManager(); }
            else { this.dom.modal.classList.remove('open'); }
        }
    };
    
    data = {
        addProject: () => {
            const name = this.dom.newProjectName.value.trim();
            if (!name) return;
            this.db.projects.push({ id: 'p_' + Date.now(), name, color: this.dom.newProjectColor.value });
            this.saveDB();
            this.dom.newProjectName.value = '';
            this.renderProjectSelect();
            this.renderProjectManager();
        },
        deleteProject: (id) => {
            if (this.db.projects.length <= 1) return alert('Keep at least one project.');
            this.db.projects = this.db.projects.filter(p => p.id !== id);
            if (this.state.selectedProjectId === id) this.state.selectedProjectId = this.db.projects[0].id;
            this.saveDB();
            this.renderProjectSelect();
            this.renderProjectManager();
        },
        deleteLog: (id) => {
            if(!confirm('Delete this log?')) return;
            this.db.logs = this.db.logs.filter(l => l.id !== id);
            this.saveDB();
            this.updateUI();
        },
        exportData: () => {
            const blob = new Blob([JSON.stringify(this.db, null, 2)], { type: "application/json" });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `flowstate_backup.json`;
            a.click();
        },
        importData: (input) => {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.projects) { this.db = data; this.saveDB(); location.reload(); }
                } catch(err) { alert('Invalid file format'); }
            };
            reader.readAsText(file);
        }
    };
    
    saveDB() { localStorage.setItem('flowStateDB', JSON.stringify(this.db)); }
    
    setMode(mode) {
        if (this.state.isRunning) return alert('Please stop the timer first.');
        this.state.mode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.reset();
    }
    
    start() {
        if (this.state.isRunning) return;
        this.state.isRunning = true;
        this.state.startTime = Date.now();
        this.dom.startBtn.disabled = true;
        this.dom.stopBtn.disabled = false;
        this.dom.startBtn.style.opacity = '0.5';
        
        // Feature: Audio Context for Sound
        if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        this.state.timerId = setInterval(() => {
            const passed = Math.floor((Date.now() - this.state.startTime) / 1000);
            if (this.state.mode === 'stopwatch') this.updateDisplay(passed);
            else {
                const remaining = this.state.duration - passed;
                if (remaining <= 0) this.stop(true);
                else this.updateDisplay(remaining);
            }
        }, 1000);
    }
    
    stop(auto = false) {
        clearInterval(this.state.timerId);
        this.state.isRunning = false;
        this.dom.startBtn.disabled = false;
        this.dom.stopBtn.disabled = true;
        this.dom.startBtn.style.opacity = '1';
        const passed = Math.floor((Date.now() - this.state.startTime) / 1000);
        const duration = auto ? this.state.duration : passed;
        
        if (duration > 2) {
            this.db.logs.unshift({ id: Date.now(), projectId: this.state.selectedProjectId, duration, date: new Date().toISOString() });
            this.saveDB();
            this.updateUI();
            
            if (auto) {
                this.playAlarm(); // Feature: Play Sound
                document.title = "‚úÖ Completed! - FlowState"; // Feature: Update Title
                alert('Focus Session Complete!');
            }
        }
        this.reset();
    }
    
    reset() {
        if (this.state.isRunning) clearInterval(this.state.timerId);
        this.state.isRunning = false;
        this.dom.startBtn.disabled = false;
        this.dom.stopBtn.disabled = true;
        this.updateDisplay(this.state.mode === 'pomodoro' ? this.state.duration : 0);
    }
    
    updateDisplay(s) {
        const m = Math.floor(s / 60).toString().padStart(2, '0');
        const sec = (s % 60).toString().padStart(2, '0');
        this.dom.display.textContent = `${m}:${sec}`;
        document.title = `${m}:${sec} - FlowState`;
    }
    
    // Feature: Sound Generation (No external file needed)
    playAlarm() {
        try {
            const ctx = this.audioCtx;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(587.33, ctx.currentTime); // D5
            osc.frequency.exponentialRampToValueAtTime(1174.66, ctx.currentTime + 0.1); // High pitch
            
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
            
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
            
            // Second beep
            setTimeout(() => {
                const osc2 = ctx.createOscillator();
                const gain2 = ctx.createGain();
                osc2.connect(gain2);
                gain2.connect(ctx.destination);
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(587.33, ctx.currentTime);
                gain2.gain.setValueAtTime(0.1, ctx.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                osc2.start();
                osc2.stop(ctx.currentTime + 0.5);
            }, 600);
        } catch(e) { console.log('Audio play failed', e); }
    }
    
    getProject(id) { return this.db.projects.find(p => p.id === id) || { name: 'Unknown', color: '#64748b' }; }
    
    renderProjectSelect() {
        this.dom.projectSelect.innerHTML = this.db.projects.map(p => 
            `<option value="${p.id}" ${p.id === this.state.selectedProjectId ? 'selected' : ''}>${p.name}</option>`
        ).join('');
        this.state.selectedProjectId = this.dom.projectSelect.value;
    }
    
    renderProjectManager() {
        this.dom.projectList.innerHTML = this.db.projects.map(p => `
            <div class="project-list-item">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:12px; height:12px; border-radius:50%; background:${p.color}"></div>
                    <span>${p.name}</span>
                </div>
                <button onclick="app.data.deleteProject('${p.id}')" class="delete-btn">Delete</button>
            </div>
        `).join('');
    }
    
    updateUI() {
        this.updateRecentLogs();
        this.updateTodayStats();
        if (this.charts.pie) this.updateCharts();
    }
    
    updateRecentLogs() {
        this.dom.recentLogs.innerHTML = this.db.logs.slice(0, 10).map(log => {
            const p = this.getProject(log.projectId);
            const d = new Date(log.date);
            const timeStr = `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2,'0')}`;
            const m = Math.floor(log.duration / 60);
            const s = Math.floor(log.duration % 60);
            const durationStr = `${m}m ${s}s`; 
            return `
                <div class="log-item">
                    <div><span style="color:${p.color}">‚óè</span> ${p.name} <span style="font-size:0.8rem; opacity:0.5; margin-left:5px;">${timeStr}</span></div>
                    <div>${durationStr} <button class="delete-btn" onclick="app.data.deleteLog(${log.id})">‚úñ</button></div>
                </div>`;
        }).join('') || '<div style="text-align:center; padding:20px; opacity:0.5">No logs yet</div>';
    }
    
    updateTodayStats() {
        const today = new Date().toISOString().split('T')[0];
        const logs = this.db.logs.filter(l => l.date.startsWith(today));
        const total = logs.reduce((a, b) => a + b.duration, 0);
        const h = Math.floor(total / 3600);
        const m = Math.floor((total % 3600) / 60);
        const s = Math.floor(total % 60);
        this.dom.todayTotal.textContent = `${h}h ${m}m ${s}s`;
        this.dom.todayCount.textContent = logs.length;
    }
    
    initCharts() {
        if (typeof Chart === 'undefined') return;
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
        this.charts.pie = new Chart(document.getElementById('pieChart'), {
            type: 'doughnut', data: { labels: [], datasets: [] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
        });
        this.charts.bar = new Chart(document.getElementById('barChart'), {
            type: 'bar', data: { labels: [], datasets: [] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
        this.updateCharts();
    }
    
    updateCharts() {
        if (!this.charts.pie) return;
        const pieStats = {};
        this.db.logs.forEach(l => { if (!pieStats[l.projectId]) pieStats[l.projectId] = 0; pieStats[l.projectId] += l.duration; });
        const pLabels = [], pData = [], pColors = [];
        Object.keys(pieStats).forEach(pid => {
            const p = this.getProject(pid);
            pLabels.push(p.name); 
            pData.push((pieStats[pid]/60).toFixed(1)); 
            pColors.push(p.color);
        });
        this.charts.pie.data = { labels: pLabels, datasets: [{ data: pData, backgroundColor: pColors, borderWidth: 0 }] };
        this.charts.pie.update();
        const bLabels = [], bData = {};
        for(let i=6; i>=0; i--) {
            const d = new Date(); d.setDate(d.getDate()-i);
            const k = d.toISOString().split('T')[0];
            bLabels.push(`${d.getMonth()+1}/${d.getDate()}`);
            bData[k] = 0;
        }
        this.db.logs.forEach(l => { const k = l.date.split('T')[0]; if(bData.hasOwnProperty(k)) bData[k] += l.duration; });
        this.charts.bar.data = { labels: bLabels, datasets: [{ label: 'Duration (Minutes)', data: Object.values(bData).map(v=>(v/60).toFixed(1)), backgroundColor: '#3b82f6', borderRadius: 4 }] };
        this.charts.bar.update();
    }
}
const app = new TimeMaster();
</script>
</body>
</html>
